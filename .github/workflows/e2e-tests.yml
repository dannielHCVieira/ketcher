name: E2E Tests - Playwright

on:
  workflow_dispatch:
  push:
    branches: [main, master, develop]
  pull_request:

jobs:
  e2e-tests:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Cache dependencies
        uses: actions/cache@v4
        with:
          path: |
            node_modules
            ~/.cache/ms-playwright
          key: ${{ runner.os }}-node-playwright-${{ hashFiles('package-lock.json', 'yarn.lock') }}
          restore-keys: |
            ${{ runner.os }}-node-playwright-
      
      - name: Install dependencies
        run: |
          if [ -f "yarn.lock" ]; then
            yarn install --frozen-lockfile
          else
            npm ci
          fi
      
      - name: Install Playwright browsers
        run: npx playwright install --with-deps
      
      - name: Build TypeScript
        run: |
          if [ -f "yarn.lock" ]; then
            yarn build --if-present || true
          else
            npm run build --if-present || true
          fi
        continue-on-error: true
      
      - name: Run E2E Tests
        run: npx playwright test ketcher-autotests/tests/API/api-set-get-molecule.spec.ts ketcher-autotests/tests/API/is-query-structure-selected.spec.ts ketcher-autotests/tests/Examples/ketcher-api.spec.ts ketcher-autotests/tests/Examples/ketcher-canvas.spec.ts ketcher-autotests/tests/Examples/ketcher-files.spec.ts ketcher-autotests/tests/File-Management/Open-And-Save-Files/cdxml-files.spec.ts ketcher-autotests/tests/File-Management/Open-And-Save-Files/open-save-files.spec.ts ketcher-autotests/tests/File-Management/Open-And-Save-Files/CDX-Files/cdx-files.spec.ts ketcher-autotests/tests/File-Management/Open-And-Save-Files/CDXML-Enhanced-Stereochemistry/cdxml-enhanced-stereochemistry.spec.ts ketcher-autotests/tests/File-Management/Open-And-Save-Files/Cml-files/cml-files.spec.ts ketcher-autotests/tests/File-Management/Open-And-Save-Files/InChi/InChi.spec.ts ketcher-autotests/tests/File-Management/Open-And-Save-Files/KET-Files/ket-files-properties.spec.ts ketcher-autotests/tests/File-Management/Open-And-Save-Files/MOL-Files/mol-files-export-import-query-features.spec.ts ketcher-autotests/tests/File-Management/Open-And-Save-Files/MOL-Files/mol-files.spec.ts ketcher-autotests/tests/File-Management/Open-And-Save-Files/MOL-Files/mol-with-rbc-sub-unc-queries.spec.ts ketcher-autotests/tests/File-Management/Open-And-Save-Files/Open-File/open-file.spec.ts ketcher-autotests/tests/File-Management/Open-And-Save-Files/Open-File/Load-Fragment/load-fragment.spec.ts ketcher-autotests/tests/File-Management/Open-And-Save-Files/PPTX-Files/pptx-files.spec.ts ketcher-autotests/tests/File-Management/Open-And-Save-Files/Rxn-Files/rxn-files.spec.ts ketcher-autotests/tests/File-Management/Open-And-Save-Files/Save-File/save-file.spec.ts ketcher-autotests/tests/File-Management/Open-And-Save-Files/SDF-Files/sdf-files.spec.ts ketcher-autotests/tests/File-Management/SMARTS-Files/smarts-files.spec.ts ketcher-autotests/tests/File-Management/Smile-Files/smile-files.spec.ts ketcher-autotests/tests/Indigo-Tools/Aromatize-Dearomatize/aromatize-dearomatize.spec.ts ketcher-autotests/tests/Indigo-Tools/Calculate-CIP-Tool/calculate-cip-tool.spec.ts ketcher-autotests/tests/Indigo-Tools/Calculated-Values-Tool/calculated-values.spec.ts ketcher-autotests/tests/Indigo-Tools/Clean-Tools/clean-tools.spec.ts ketcher-autotests/tests/Indigo-Tools/Enhanced-Stereochemistry/enhanced-stereochemistry.spec.ts ketcher-autotests/tests/Indigo-Tools/Layout/layout.spec.ts ketcher-autotests/tests/Indigo-Tools/Reaction Auto-mapping tool/reaction-am-tool-veryfing-button.spec.ts ketcher-autotests/tests/Indigo-Tools/Toggle-Explicit-Hydrogens/toggle-explicit-hydrogens.spec.ts ketcher-autotests/tests/Macromolecule-editor/Chem-monomers/chem-add-to-canvas.spec.ts ketcher-autotests/tests/Macromolecule-editor/Chem-monomers/chem-library.spec.ts ketcher-autotests/tests/Macromolecule-editor/Clear-Tool/clear-tool.spec.ts ketcher-autotests/tests/Macromolecule-editor/Copy-And-Paste/flex-mode-copy-paste.spec.ts ketcher-autotests/tests/Macromolecule-editor/Copy-And-Paste/sequence-mode-copy-paste.spec.ts ketcher-autotests/tests/Macromolecule-editor/Copy-And-Paste/snake-mode-copy-paste.spec.ts ketcher-autotests/tests/Macromolecule-editor/Enumerations/enumerations.spec.ts ketcher-autotests/tests/Macromolecule-editor/Erase-Tool/erase-tool.spec.ts ketcher-autotests/tests/Macromolecule-editor/Favorites/favorites-add-to-canvas.spec.ts ketcher-autotests/tests/Macromolecule-editor/Hotkeys/hotkeys.spec.ts ketcher-autotests/tests/Macromolecule-editor/Import-Saving-Files/import-saving-fasta.spec.ts ketcher-autotests/tests/Macromolecule-editor/Import-Saving-Files/import-saving-idt.spec.ts ketcher-autotests/tests/Macromolecule-editor/Import-Saving-Files/import-saving-ket.spec.ts ketcher-autotests/tests/Macromolecule-editor/Import-Saving-Files/import-saving-mol.spec.ts ketcher-autotests/tests/Macromolecule-editor/Import-Saving-Files/import-saving-sequence.spec.ts ketcher-autotests/tests/Macromolecule-editor/Import-Saving-Files/saving-svg.spec.ts ketcher-autotests/tests/Macromolecule-editor/Macro-Micro-Switcher/macro-micro-switcher.spec.ts ketcher-autotests/tests/Macromolecule-editor/Modal-window/modal-window.spec.ts ketcher-autotests/tests/Macromolecule-editor/Peptides/peptide-monomer-library.spec.ts ketcher-autotests/tests/Macromolecule-editor/Peptides/peptides-add-to-canvas.spec.ts ketcher-autotests/tests/Macromolecule-editor/Polymer-Bond-Tool/attachment-point-hover.spec.ts ketcher-autotests/tests/Macromolecule-editor/Polymer-Bond-Tool/attachment-point-rotation.spec.ts ketcher-autotests/tests/Macromolecule-editor/Polymer-Bond-Tool/polymer-bond-tool.spec.ts ketcher-autotests/tests/Macromolecule-editor/Rectangle-Selection-Tool/rectangle-selection-tool.spec.ts ketcher-autotests/tests/Macromolecule-editor/RNA-Builder/add-custom-preset.spec.ts ketcher-autotests/tests/Macromolecule-editor/RNA-Builder/add-default-presets.spec.ts ketcher-autotests/tests/Macromolecule-editor/RNA-Builder/add-preset-to-favorites.spec.ts ketcher-autotests/tests/Macromolecule-editor/RNA-Builder/connect-phosphate-and-sugar.spec.ts ketcher-autotests/tests/Macromolecule-editor/RNA-Builder/delete-preset.spec.ts ketcher-autotests/tests/Macromolecule-editor/RNA-Builder/rna-layout.spec.ts ketcher-autotests/tests/Macromolecule-editor/RNA-Builder/rna-library.spec.ts ketcher-autotests/tests/Macromolecule-editor/Sequence-Mode/sequence-mode-edit-in-rna-builder.spec.ts ketcher-autotests/tests/Macromolecule-editor/Sequence-Mode/sequence-mode-edit.spec.ts ketcher-autotests/tests/Macromolecule-editor/Sequence-Mode/sequence-mode-selection.spec.ts ketcher-autotests/tests/Macromolecule-editor/Sequence-Mode/sequence-mode.spec.ts ketcher-autotests/tests/Macromolecule-editor/Snake-Mode/snake-bond-tool.spec.ts ketcher-autotests/tests/Macromolecule-editor/Undo-Redo/undo-redo.spec.ts ketcher-autotests/tests/Macromolecule-editor/Zoom-Tool/zoom-tool.spec.ts ketcher-autotests/tests/Macromolecule-editor/Zoom-Tool/zoom.spec.ts ketcher-autotests/tests/Reaction-tool/Mapping-Unmapping tool/mapping-tool.spec.ts ketcher-autotests/tests/Reaction-tool/Mapping-Unmapping tool/reaction-tools.spec.ts ketcher-autotests/tests/Reactions/Reaction-tools/Plus-and-Arrow-tools/plus-and-arrows-tools.spec.ts ketcher-autotests/tests/Reactions/Reaction-Validation/reaction-validation.spec.ts ketcher-autotests/tests/Reagents/reagents-molecule-above-arrow.spec.ts ketcher-autotests/tests/Reagents/reagents-molecule-below-arrow.spec.ts ketcher-autotests/tests/Reagents/CDX-Format/reagents-cdx-format.spec.ts ketcher-autotests/tests/Reagents/CDXML-Format/reagents-cdxml-format.spec.ts ketcher-autotests/tests/Reagents/CML-format/CML-format.spec.ts ketcher-autotests/tests/Reagents/RXN-Format/reagents-rxn-format.spec.ts ketcher-autotests/tests/Reagents/SMARTS-Format/reagents-smarts-format.spec.ts ketcher-autotests/tests/Reagents/SMILES-Format/reagents-smiles-format.spec.ts ketcher-autotests/tests/Settings/Atoms/atoms-settings.spec.ts ketcher-autotests/tests/Settings/General/default-settings-verification.spec.ts ketcher-autotests/tests/Settings/Stereochemistry/ignore-chiral-flag.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Actions-With-Structures/Attachment-Point-Tool/actions-with-attachment-point-tool.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Actions-With-Structures/Attachment-Point-Tool/attachment-point-tool.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Actions-With-Structures/Erase-Tool/erase-tool.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Actions-With-Structures/Fragment selection/fragment-selection-tool.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Actions-With-Structures/Layout/layout-tool.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Actions-With-Structures/Paste-Action/paste-action.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Actions-With-Structures/R-group-tool/r-group-fragment-tool.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Actions-With-Structures/R-group-tool/r-group-label-dialog.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Actions-With-Structures/R-group-tool/r-group-tool.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Actions-With-Structures/Rectangle selection/rectangle-tool.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Actions-With-Structures/Rotation/rotation.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Actions-With-Structures/S-Group-Tool/Data-S-Group-Tool/data-s-group-tool.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Actions-With-Structures/S-Group-Tool/Data-S-Group-Tool/s-group-click-atom-bond.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Actions-With-Structures/S-Group-Tool/Multiple-S-Group-Tool/multiple-s-group-tool.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Actions-With-Structures/S-Group-Tool/SRU-Polymer/sru-polymer-tool.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Actions-With-Structures/S-Group-Tool/Superatom-S-Group-Tool/superatom-s-group-tool.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Actions-With-Structures/Selection-Hover/simple-object-selection-and-hover.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Actions-With-Structures/Selection-Tool/bond-properties.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Actions-With-Structures/Selection-Tool/select-all.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Actions-With-Structures/Selection-Tool/selection-tool.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Actions-With-Structures/Selection-Tool/Lasso-Selection-Tool/lasso-tool.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Actions-With-Structures/Track-Changes/track-changes.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Atom/Atom-Properties/atom-properties.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Atom/Atom-Tool/atom-tool.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Atom/Atom-Tool/click-and-drag-atom-on-canvas.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Atom/Atom-Tool/click-atom-on-canvas.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Atom/Atom-Tool/drag-and-drop-atom.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Atom/Atom-Tool/group-generics-buttons-check.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Atom/Atom-Tool/Atom-Generics/atom-generics-ui.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Atom/Atom-Tool/Group-generic/extended-table-buttons.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Atom/Charge-Tool/charge-tool.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Bond-Tool/all-bonds.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Chain-Tool/chain-tool-actions.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Chain-Tool/chain-tool.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Simple-Objects/action-on-simple-objects.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Simple-Objects/simple-objects-draw-ellipse.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Simple-Objects/simple-objects-draw-line.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Simple-Objects/simple-objects-draw-rectangle.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Simple-Objects/simple-objects-ui-verification.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/SMARTS-attributes/Atom-properties-attributes/atom-properties-attributes.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/SMARTS-attributes/Bond-attributes/bond-attributes.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/SMARTS-attributes/Custom-query-attributes/custom-query.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/SMARTS-attributes/Query-specific-attributes/query-specific-attributes.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/SMARTS-attributes/Reaction-flags-attributes/reaction-flags-attributes.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/SMARTS-attributes/Reaction-queries-attributes/reaction-queries-attributes.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/SMARTS-attributes/Visual-check/visual-check.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Text-Tool/text-formating.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Text-Tool/text-tools-modification-and-manipulation.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Text-Tool/text-tools.spec.ts ketcher-autotests/tests/Structure-Creating-&-Editing/Text-Tool/utf-8-svg-png.spec.ts ketcher-autotests/tests/Templates/Custom-Templates/custom-templates.spec.ts ketcher-autotests/tests/Templates/Functional-Groups/click-and-drag-fg-on-canvas.spec.ts ketcher-autotests/tests/Templates/Functional-Groups/click-fg-on-canvas.spec.ts ketcher-autotests/tests/Templates/Functional-Groups/functional-groups.spec.ts ketcher-autotests/tests/Templates/Functional-Groups/lookup-abbreviations.spec.ts ketcher-autotests/tests/Templates/Functional-Groups/Functional-Group-Tools/functional-group-tools.spec.ts ketcher-autotests/tests/Templates/S-Groups/s-groups.spec.ts ketcher-autotests/tests/Templates/Salts-and-Solvents/check-new-salt-or-solvent-is-replacing.spec.ts ketcher-autotests/tests/Templates/Salts-and-Solvents/click-and-drag-salts-on-canvas.spec.ts ketcher-autotests/tests/Templates/Salts-and-Solvents/click-salts-on-canvas.spec.ts ketcher-autotests/tests/Templates/Template-Library/template-library.spec.ts ketcher-autotests/tests/Templates/Template-Manipulations/Template-manipulations.spec.ts ketcher-autotests/tests/Templates/User-Templates/user-templates.spec.ts ketcher-autotests/tests/User-Interface/periodic-table.spec.ts ketcher-autotests/tests/User-Interface/Abbreviation-Lookup/abbreviation-lookup.spec.ts ketcher-autotests/tests/User-Interface/About/about-ui.spec.ts ketcher-autotests/tests/User-Interface/Clear-Canvas/clear-canvas.spec.ts ketcher-autotests/tests/User-Interface/Editing-Tools/3D-Viewer/three-d-viewer.spec.ts ketcher-autotests/tests/User-Interface/Editing-Tools/Copy-Cut-Paste/copy-cut-paste.spec.ts ketcher-autotests/tests/User-Interface/Editing-Tools/Undo-Redo/undo-redo-actions.spec.ts ketcher-autotests/tests/User-Interface/Floating-windows/floating-windows.spec.ts ketcher-autotests/tests/User-Interface/Hand-tool/hand-tool.spec.ts ketcher-autotests/tests/User-Interface/Hot-Keys/hotkeys.spec.ts ketcher-autotests/tests/User-Interface/Left-toolbar/left-toolbar-ui.spec.ts ketcher-autotests/tests/User-Interface/Outline-For-Hovered-Structures/outline-for-hovered-structures.spec.ts ketcher-autotests/tests/User-Interface/Preview-For-Abbreviated-Structures/preview-for-abbreviated-structures.spec.ts ketcher-autotests/tests/User-Interface/Right-Click-Menu/right-click.spec.ts ketcher-autotests/tests/User-Interface/Save-Dialog/save-dialog.spec.ts ketcher-autotests/tests/User-Interface/Scroll/scroll-canvas.spec.ts ketcher-autotests/tests/User-Interface/Select-Tools/select-tools.spec.ts ketcher-autotests/tests/User-Interface/Toolbar/toolbar-ui.spec.ts ketcher-autotests/tests/User-Interface/Toolbar/toolbar.spec.ts ketcher-autotests/tests/User-Interface/Zoom-Changes/zoom-changes.spec.ts ketcher-autotests/tests/utils/canvas/tools/selectNestedTool/example.spec.ts
      
      - name: Upload Playwright report
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: playwright-report
          path: playwright-report
          if-no-files-found: ignore
